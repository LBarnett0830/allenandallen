<apex:page sidebar="false" docType="html-5.0" standardController="litify_pm__Expense__c" extensions="cancelExpenseController" >
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script>
            
            function showDiv(divId){
            $('[id$='+divId+']').removeClass('slds-hide');
        }
        function hideDiv(divId){
            $('[id$='+divId+']').addClass('slds-hide');
        }
        </script>
        
    </head>
    <apex:form style="height:300px;">
        <apex:slds />
        <apex:actionFunction name="redirectToDetail" action="{!redirectToDetail}" reRender="pnlDummy" />
        <apex:actionFunction name="redirectToList" action="{!redirectToList}" reRender="pnlDummy" />
        <apex:actionFunction name="checkValidation" action="{!checkValidation}" reRender="pnlSuccess,pnlError,pnlScript" oncomplete="showSuccessMsg();" />
        
        <apex:outputPanel id="pnlScript">
            <script>
            console.log('{!showSuccess}');
            function showSuccessMsg() {
                console.log('called showSuccessMsg');
                var showSuccess = '{!showSuccess}';
                var showError = '{!showError}';
                
                if(showSuccess== 'true'){ 
                    hideDiv('divErrorMsg');
                    hideDiv('divPayModal');
                    $("div[id$=divSuccessMsg]").removeClass('slds-hide');
                    setTimeout(function() {
                        $("div[id$=divSuccessMsg]").addClass('slds-hide');
                        redirectToDetail();
                    }, 3000);
                } 
                if(showError == 'true'){
                    
                    $("div[id$=divErrorMsg]").removeClass('slds-hide');
                    setTimeout(function() {
                        $("div[id$=divErrorMsg]").addClass('slds-hide');
                        redirectToDetail();
                    }, 3000);
                }   
            }
            </script>
        </apex:outputPanel>
        
        
        <div id="divConfirmation" class="">                
            
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_small" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Cancel Expense</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1" style="text-align:center;">
                        <span>Do you want to cancel the Expense?</span>
                    </div>
                    <footer class="slds-modal__footer">
                        <center>
                            <button  onclick="redirectToDetail();hideDiv('divConfirmation');return false;"
                                    class="slds-button slds-button_neutral"> No</button>
                            <button  onclick="checkValidation(); hideDiv('divConfirmation');showDiv('divLoading'); return false;"
                                    class="slds-button slds-button_brand">Yes</button>
                            
                        </center>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>            
            
        </div>
        
        <div class="slds-notify_container slds-hide" id="divErrorMsg" >
            <apex:outputPanel id="pnlError">
                <div class="slds-notify slds-notify--toast slds-theme--error" role="alert">
                    <span class="slds-assistive-text">Warning</span>
                    <button class="slds-button slds-notify__close slds-button--icon-inverse" title="Close" onclick="hideDiv('divErrorMsg'); return false;">
                        <svg class="slds-button__icon slds-button__icon--large" aria-hidden="true" onclick="return false;" data="msg">
                            <use xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                        </svg>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading--small">{!errorMsg}</h2>
                    </div>
                </div>
            </apex:outputPanel>    
        </div>
        
        <apex:outputPanel id="pnlSuccess">
            <apex:outputPanel rendered="{!showSuccess}">
                <div class="slds-notify_container " id="divSuccessMsg">
                    <div class="slds-notify slds-notify--toast slds-theme--success" role="alert">
                        <span class="slds-assistive-text">Success</span>
                        <button class="slds-button slds-notify__close slds-button--icon-inverse" title="Close" onclick="hideDiv('divSuccessMsg'); return false;">
                            <svg class="slds-button__icon slds-button__icon--large" aria-hidden="true" onclick="return false;" data="msg">
                                <use xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,'/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                            </svg>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <div class="slds-notify__content">
                            <h2 class="slds-text-heading--small">Expense record was successfully cancelled.</h2>
                        </div>
                    </div>
                </div>
            </apex:outputPanel>
        </apex:outputPanel>
        
        <div id="divLoading" class="slds-hide">
            <div class="demo-only demo-only demo-only_viewport demo--inverse" style="height:6rem">
                <div class="slds-spinner_container slds-is-fixed">
                    <div role="status" class="slds-spinner slds-spinner_medium">
                        <span class="slds-assistive-text">Loading</span>
                        <div class="slds-spinner__dot-a"></div>
                        <div class="slds-spinner__dot-b"></div>
                    </div>
                </div>
            </div>
        </div>
        
        
    </apex:form>
    
</apex:page>